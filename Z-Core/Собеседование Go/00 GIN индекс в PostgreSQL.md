2025030222:46
___
Date: 02-03-2025 | 22:46
Tags: #
mapofcontents: [[zero-links|OO Links]]
___
## Что такое gin индекс?

**GIN (Generalized Inverted Index)** — это тип индекса в PostgreSQL, предназначенный для ускорения поиска в структурах данных с множественными значениями, таких как массивы, JSONB, полнотекстовый поиск и другие композитные типы. Он особенно эффективен для запросов, где нужно найти строки, содержащие определенные элементы или ключи. 

---
### Что такое GIN индекс?

#### Определение

- GIN — это **инвертированный индекс**, который хранит отображение значений (или элементов) на строки таблицы, где эти значения встречаются.
- "Generalized" означает, что он универсален и адаптируется под разные типы данных через операторные классы.
#### Структура
  
- **Ключи**: Уникальные элементы данных (например, элементы массива, слова в тексте, ключи JSON).
- **Список указателей**: Для каждого ключа — набор ссылок (TID, tuple identifiers) на строки, где этот ключ присутствует.
- Пример: Для массива [1, 2, 3] GIN хранит:  
    - 1 → строка 1, 2 → строка 1, 3 → строка 1.

---
### Как работает GIN индекс?

1. **Индексация**:  
    - Разбивает данные на отдельные элементы (tokens).
    - Создает таблицу: элемент → список строк.
2. **Поиск**:  
    - Для запроса вроде `WHERE array_column @> ARRAY[2]` GIN быстро находит строки, где есть `2`.
    - Объединяет списки для сложных условий (например, `ARRAY[2] AND ARRAY[3]`).  
3. **Эффективность**:  
    - Быстрее полного сканирования для многозначных данных.
    - Использует сжатие и дерево (B-tree-like) для хранения ключей.
  
---
### Когда использовать GIN индекс?

#### Поддерживаемые типы данных

- **Массивы**: Поиск элементов (`@>`, `<@`, `&&`).
- **JSONB**: Поиск по ключам/значениям (`@>`, `?`).
- **Полнотекстовый поиск**: Поиск слов или фраз (`@@` с `tsvector`).
- **Hstore**: Поиск ключей/значений.
#### Примеры использования
  
1. **Массивы**:
```sql
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    tags TEXT[]
);
INSERT INTO products (tags) VALUES
    ('{red, blue}'),
    ('{blue, green}');

CREATE INDEX idx_tags ON products USING GIN (tags);

SELECT * FROM products WHERE tags @> ARRAY['blue'];
```

- GIN находит все строки с тегом blue.

2. **JSONB**:
```sql
CREATE TABLE docs (
    id SERIAL PRIMARY KEY,
    data JSONB
);
INSERT INTO docs (data) VALUES
    ('{"name": "Alice", "city": "NY"}'),
    ('{"name": "Bob", "city": "SF"}');

CREATE INDEX idx_data ON docs USING GIN (data);

SELECT * FROM docs WHERE data @> '{"city": "NY"}';
```

- GIN ускоряет поиск по city.

3. **Полнотекстовый поиск**:
```sql
CREATE TABLE articles (
    id SERIAL PRIMARY KEY,
    content TEXT
);
CREATE INDEX idx_content ON articles USING GIN (to_tsvector('english', content));

SELECT * FROM articles WHERE to_tsvector('english', content) @@ to_tsquery('english', 'quick & brown');
```

- GIN находит статьи с "quick" и "brown".

---
### Преимущества GIN индекса

1. **Эффективность для многозначных данных**:  
    - Быстрее, чем B-tree, для массивов или JSON, где много элементов в одной строке.
2. **Компактность**:  
    - Хранит только уникальные ключи, сжимая повторения.
3. **Гибкость**:  
    - Поддерживает разные операторы (`@>`, `&&`, `@@`).
### Недостатки

1. **Медленная запись**:  
    - Обновление GIN индекса (при `INSERT`, `UPDATE`) дороже, чем B-tree, из-за разбиения на элементы.
2. **Размер**:  
    - Может быть большим для сложных данных (много элементов в JSON/массивах).
3. **Ограниченная применимость**:  
    - Не подходит для простых столбцов (например, `int`), где B-tree лучше.

---
### Когда использовать?

- **Массивы**: Поиск по элементам (например, теги, категории).
- **JSONB**: Фильтрация по вложенным ключам/значениям.
- **Полнотекстовый поиск**: Поиск слов в тексте.
- **Hstore**: Работа с парами ключ-значение.
### Когда НЕ использовать?

- Простые типы (`int`, `varchar`) — используйте B-tree.
- Часто обновляемые таблицы — GIN замедлит запись.
- Запросы без многозначных условий — индекс не даст выигрыша.
- 
---
### Итог

GIN индекс в PostgreSQL:

- Это инвертированный индекс для многозначных данных (массивы, JSONB, текст).
- Ускоряет поиск элементов, но замедляет запись.
- Эффективен для запросов с операторами `@>`, `&&`, `@@`.

Используйте его для сложных структур, где B-tree не подходит.


-----
**Zero-Links**  (Внутренние ссылки) Линки - ключевые слова
-

------
**Links** (Внешние ссылки)
-
