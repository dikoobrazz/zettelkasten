2025030417:53
___
Date: 04-03-2025 | 17:53
Tags: #
mapofcontents: [[zero-links|OO Links]]
___
## Как между собой общаются горутины

> В Go горутины общаются между собой преимущественно через **каналы** (channels), которые являются основным механизмом синхронизации и передачи данных. Это реализует принцип "не дели память для общения, общайся для разделения памяти". Однако есть и другие способы, такие как использование примитивов из пакета `sync`.

---
### Основные способы общения горутин

#### 1. **Каналы (Channels)**

- **Что это**: Типизированные очереди для передачи данных между горутинами.
- **Как работает**:
    - Отправка: `ch <- value`.
    - Получение: `value := <-ch`.
    - Синхронизация встроена: отправитель и получатель ждут друг друга (для небуферизированных каналов).
- **Типы**:
    - Небуферизированные (`make(chan T)`): Блокируют до парного действия.
    - Буферизированные (`make(chan T, n)`): Позволяют отправлять до nnn элементов без блокировки.
##### Пример
```go
package main

import "fmt"

func sender(ch chan<- int) {
    ch <- 42 // отправляем значение в канал
    fmt.Println("Отправлено 42")
}

func receiver(ch <-chan int) {
    value := <-ch // получаем значение из канала
    fmt.Println("Получено:", value)
}

func main() {
    ch := make(chan int) // небуферизированный канал
    go sender(ch)       // запускаем отправителя
    go receiver(ch)     // запускаем получателя
    time.Sleep(1 * time.Second) // ждем завершения
}
```

- **Комментарий**:
    - `sender` блокируется на `ch <- 42`, пока `receiver` не прочитает.
    - Канал обеспечивает синхронизацию и передачу данных.
#### 2. **Общая память с мьютексами (sync.Mutex)**

- **Что это**: Горутины используют общую переменную, защищенную мьютексом, для обмена данными.
- **Как работает**:
    - `Lock()` и `Unlock()` защищают доступ к памяти.
    - Не является прямым "общением", а скорее совместным использованием ресурсов.
##### Пример
```go
package main

import (
    "fmt"
    "sync"
)

func main() {
    var mu sync.Mutex // мьютекс для синхронизации
    data := 0         // общая переменная
    var wg sync.WaitGroup

    wg.Add(2)
    go func() { // горутина 1: запись
        defer wg.Done()
        mu.Lock()   // блокируем доступ
        data = 42   // записываем значение
        mu.Unlock() // разблокируем
    }()

    go func() { // горутина 2: чтение
        defer wg.Done()
        mu.Lock()       // блокируем доступ
        value := data   // читаем значение
        mu.Unlock()     // разблокируем
        fmt.Println("Прочитано:", value)
    }()

    wg.Wait() // ждем завершения
}
```

- **Комментарий**:
    - `mu.Lock()` позволяет одной горутине записать, другой — прочитать, избегая data race.
#### 3. **Условные переменные (sync.Cond)**

- **Что это**: Механизм для сигнализации между горутинами о событиях.
- **Как работает**:
    - `Wait()` блокирует горутину до сигнала.
    - `Signal()` или `Broadcast()` будят одну или все ожидающие горутины.
##### Пример
```go
package main

import (
    "fmt"
    "sync"
)

func main() {
    var mu sync.Mutex
    cond := sync.NewCond(&mu) // условная переменная
    ready := false            // флаг готовности
    var wg sync.WaitGroup

    wg.Add(1)
    go func() { // горутина-ждун
        defer wg.Done()
        mu.Lock()
        for !ready { // ждем, пока ready не станет true
            cond.Wait() // блокируемся до сигнала
        }
        fmt.Println("Горутина разбужена")
        mu.Unlock()
    }()

    time.Sleep(100 * time.Millisecond) // имитация задержки
    mu.Lock()
    ready = true    // устанавливаем флаг
    cond.Signal()   // сигнализируем одной горутине
    mu.Unlock()

    wg.Wait() // ждем завершения
}
```

- **Комментарий**:
    - `cond.Wait()` блокирует горутину, `cond.Signal()` её будит, передавая управление.

---
### Коротко: Как общаются?

- **Каналы**: Основной способ — передача данных и синхронизация.
- **Мьютексы**: Через общую память с защитой доступа.
- **Cond**: Сигнализация о событиях.
#### Что выбрать?

- **Каналы**: Для передачи данных и простоты (рекомендуемый подход в Go).
- **Мьютексы**: Для сложных сценариев с общей памятью.
- **Cond**: Для ожидания условий.

-----
**Zero-Links**  (Внутренние ссылки) Линки - ключевые слова
-

------
**Links** (Внешние ссылки)
-
