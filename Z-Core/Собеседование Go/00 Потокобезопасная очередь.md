2025040221:31
___
Date: 02-04-2025 | 21:31
Tags: #
mapofcontents: [[zero-links|OO Links]]
___
## Потокобезопасные структуры данных с использованием каналов

Когда несколько горутин одновременно пытаются работать с одним ресурсом (например, с массивом или картой), нам нужно гарантировать, что доступ к этому ресурсу будет синхронизирован. В Go для этого есть несколько способов, но один из простых и эффективных способов — использование каналов для контроля доступа.

### Потокобезопасная очередь

Предположим, нам нужно создать очередь, в которой несколько горутин могут безопасно читать и записывать данные. Мы будем использовать канал для синхронизации операций.

```go
package main

import (
	"fmt"
	"sync"
)

type SafeQueue struct {
	queue []int
	mu    sync.Mutex
}

func (q *SafeQueue) Enqueue(value int) {
	q.mu.Lock()
	defer q.mu.Unlock()
	q.queue = append(q.queue, value)
}

func (q *SafeQueue) Dequeue() (int, bool) {
	q.mu.Lock()
	defer q.mu.Unlock()
	if len(q.queue) == 0 {
		return 0, false
	}
	value := q.queue[0]
	q.queue = q.queue[1:]
	return value, true
}

func main() {
	var wg sync.WaitGroup
	queue := &SafeQueue{}

	// Горутинки, которые будут вставлять элементы в очередь
	for i := 1; i <= 3; i++ {
		wg.Add(1)
		go func(i int) {
			defer wg.Done()
			queue.Enqueue(i)
			fmt.Printf("Вставлено: %d\n", i)
		}(i)
	}

	// Ждём завершения всех горутин по вставке
	wg.Wait()

	// Горутинки, которые будут извлекать элементы из очереди
	for i := 1; i <= 3; i++ {
		wg.Add(1)
		go func() {
			defer wg.Done()
			if value, ok := queue.Dequeue(); ok {
				fmt.Printf("Извлечено: %d\n", value)
			} else {
				fmt.Println("Очередь пуста")
			}
		}()
	}

	wg.Wait() // Ждём завершения всех горутин
}
```

### Объяснение:

- Мы создаём структуру `SafeQueue`, которая использует **мьютекс** (`sync.Mutex`), чтобы синхронизировать доступ к очереди. Это гарантирует, что только одна горутина может изменять очередь в каждый момент времени.
- Методы `Enqueue` и `Dequeue` блокируют очередь с помощью мьютекса, чтобы другие горутины не могли вмешиваться в операцию.
##### Вывод:
```text
Вставлено: 1
Вставлено: 2
Вставлено: 3
Извлечено: 1
Извлечено: 2
Извлечено: 3
```

-----
**Zero-Links**  (Внутренние ссылки) Линки - ключевые слова
-

------
**Links** (Внешние ссылки)
-
