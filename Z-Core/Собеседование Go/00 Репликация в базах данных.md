2025030217:53
___
Date: 02-03-2025 | 17:53
Tags: #
mapofcontents: [[zero-links|OO Links]]
___
## Зачем нужна репликация в базах данных?

> Репликация в базах данных — это процесс копирования данных из одной базы (мастер) в одну или несколько других баз (реплик), чтобы обеспечить их синхронизацию. Это важный механизм для повышения надежности, производительности и доступности данных.

---
### Что такое репликация?
  
> **Репликация** — это создание и поддержание копий данных на нескольких серверах. 

Обычно есть:

- **Мастер (Primary)**: Источник правды, куда пишутся данные.
- **Реплики (Replicas/Slaves)**: Копии, которые синхронизируются с мастером и чаще всего используются для чтения.

---
### Зачем нужна репликация?
  
#### 1. Повышение доступности (High Availability)

- **Почему**: Если мастер-сервер выходит из строя, реплики могут продолжать обслуживать запросы или стать новым мастером.
- **Пример**: Веб-приложение с базой PostgreSQL. Мастер упал из-за сбоя оборудования, но реплика продолжает отвечать на запросы чтения.
- **Как**: Используется failover — автоматический переход на реплику.
#### 2. Увеличение производительности

- **Почему**: Распределение нагрузки между мастером (запись) и репликами (чтение) снижает нагрузку на один сервер.
- **Пример**: Соцсеть вроде Twitter: запись твитов идет на мастер, а чтение ленты — с реплик.
- **Как**: Запросы SELECT отправляются на реплики, INSERT/UPDATE — на мастер.
#### 3. Географическое распределение

- **Почему**: Реплики в разных регионах уменьшают задержку (latency) для пользователей.
- **Пример**: Пользователь из США читает данные с реплики в США, а из Европы — с европейской реплики, хотя запись идет на мастер в центральном дата-центре.
- **Как**: Используется синхронизация через сеть (репликация с задержкой).
#### 4. Резервное копирование и восстановление

- **Почему**: Реплики служат "живой" копией данных, которую можно использовать для восстановления при сбое мастера.
- **Пример**: Мастер потерял данные из-за сбоя диска, но реплика сохранила актуальную копию.
- **Как**: Реплики синхронизируются в реальном времени или с небольшой задержкой.
#### 5. Отказоустойчивость

- **Почему**: Данные дублируются, снижая риск их потери.
- **Пример**: В кластере из трех серверов один упал, но два других продолжают работать.
- **Как**: Репликация с механизмом консенсуса (например, Raft в MongoDB).
  
---
### Типы репликации

1. **Синхронная (Synchronous)**:  
    - Мастер ждет подтверждения от всех реплик перед завершением операции.
    - Плюс: Полная согласованность (strong consistency).
    - Минус: Высокая задержка.
    - Пример: PostgreSQL с `synchronous_commit = on`.
2. **Асинхронная (Asynchronous)**:  
    - Мастер записывает данные и не ждет реплик.
    - Плюс: Быстрее для записи  
    - Минус: Возможна временная несогласованность (eventual consistency).
    - Пример: MySQL с Master-Slave репликацией.
3. **Полусинхронная (Semi-Synchronous)**:  
    - Мастер ждет хотя бы одну реплику.
    - Баланс между скоростью и надежностью.

---
### Как работает репликация?

#### Пример: PostgreSQL

1. **Логи (WAL)**: Мастер записывает изменения в Write-Ahead Log (журнал).
2. **Передача**: Лог отправляется репликам через сеть.
3. **Применение**: Реплики воспроизводят изменения из лога, синхронизируя свои данные.
```sql
-- На мастере
ALTER SYSTEM SET wal_level = replica;
ALTER SYSTEM SET max_wal_senders = 10;

-- На реплике
recovery.conf:
  primary_conninfo = 'host=master_host port=5432 user=repl password=secret'
  trigger_file = '/tmp/postgresql.trigger'
```
#### Пример: MySQL
- Мастер пишет в бинарный лог (binlog).
- Реплика читает лог через "релейный лог" и применяет изменения.

---
### Плюсы и минусы

#### Плюсы

- Высокая доступность и отказоустойчивость
- Ускорение чтения через распределение нагрузки.
- Географическая близость к пользователям.
#### Минусы

- **Сложность**: Настройка и управление репликацией требуют усилий.
- **Несогласованность**: В асинхронной репликации реплики могут отставать.
- **Задержка**: Синхронная репликация замедляет запись.
- **Ресурсы**: Больше серверов — больше затрат.

---
### Итог
  
Репликация нужна для:

- Повышения доступности и отказоустойчивости.
- Ускорения чтения и распределения нагрузки.
- Географической оптимизации и резервного копирования.

Она работает через синхронизацию данных (логи, события) между мастером и репликами, но требует баланса между скоростью, согласованностью и сложностью

-----
**Zero-Links**  (Внутренние ссылки) Линки - ключевые слова
-

------
**Links** (Внешние ссылки)
-
