2025030218:04
___
Date: 02-03-2025 | 18:04
Tags: #
mapofcontents: [[zero-links|OO Links]]
___
## Синхронная и асинхронная репликация BD

Синхронная и асинхронная репликация — это два основных подхода к копированию данных между мастером и репликами в базах данных. Они различаются по времени синхронизации, влиянию на производительность и уровню согласованности

---
### 1. Синхронная репликация

#### Что это?

- В синхронной репликации мастер ждет, пока все (или заданное число) реплик подтвердят успешное применение изменений, прежде чем завершить операцию записи для клиента.
- Данные синхронизируются в реальном времени.
#### Как работает?
  
1. Клиент отправляет операцию записи (например, `INSERT`) на мастер.
2. Мастер записывает изменение локально (обычно в WAL — Write-Ahead Log).
3. Мастер отправляет изменение всем репликам.
4. Реплики применяют изменение и отправляют подтверждение (commit) мастеру.
5. Мастер подтверждает клиенту успех только после получения всех подтверждений.
#### Пример в PostgreSQL
```sql
-- На мастере
ALTER SYSTEM SET synchronous_standby_names = 'replica1, replica2';
ALTER SYSTEM SET synchronous_commit = on;
```

- Мастер ждет, пока replica1 и replica2 подтвердят запись.
#### Характеристики

- **Согласованность**: Полная (strong consistency). Все реплики имеют актуальные данные на момент завершения операции.
- **Задержка**: Высокая, так как мастер ждет ответа от реплик (зависит от сети и расстояния).
- **Надежность**: Высокая — данные не теряются при сбое мастера, если хотя бы одна реплика жива.
#### Пример
```sql
INSERT INTO users (name) VALUES ('Alice');
```

- Мастер ждет ответа от реплик → задержка 10-20 мс (в зависимости от сети).
  
---
### 2. Асинхронная репликация

#### Что это?
  
- В асинхронной репликации мастер записывает данные локально и сразу подтверждает успех клиенту, не дожидаясь синхронизации с репликами.
- Реплики обновляются позже, асинхронно.
#### Как работает?

1. Клиент отправляет операцию записи на мастер.
2. Мастер записывает изменение (в WAL) и подтверждает клиенту успех.
3. Мастер отправляет изменения репликам в фоновом режиме (асинхронно).
4. Реплики применяют изменения с небольшой задержкой (lag).
#### Пример в MySQL
```sql
-- На мастере
SET GLOBAL binlog_format = 'ROW';
SET GLOBAL sync_binlog = 0; -- Асинхронно
```

- Мастер пишет в бинарный лог, реплики читают его позже.
#### Характеристики

- **Согласованность**: Окончательная (eventual consistency). Реплики могут отставать от мастера на миллисекунды или секунды.
- **Задержка**: Низкая для записи, так как клиент не ждет реплик.
- **Надежность**: Ниже — при сбое мастера изменения, не дошедшие до реплик, могут быть потеряны.
#### Пример
```sql
INSERT INTO users (name) VALUES ('Bob');
```

- Мастер подтверждает сразу → задержка минимальна, но реплика может увидеть Bob через 50 мс.
  
---
### Сравнение

|Характеристика|Синхронная репликация|Асинхронная репликация|
|---|---|---|
|**Согласованность**|Полная (strong)|Окончательная (eventual)|
|**Задержка записи**|Высокая (ждет реплик)|Низкая (не ждет реплик)|
|**Надежность**|Высокая (данные на репликах)|Ниже (возможна потеря)|
|**Скорость записи**|Медленнее|Быстрее|
|**Сложность сети**|Чувствительна к задержкам|Менее чувствительна|

---
### Когда использовать?

#### Синхронная репликация

- **Где**: Финансовые системы, где потеря данных недопустима (банки, биржи).
- **Пример**: Транзакция перевода денег — мастер ждет, пока реплики подтвердят запись.
- **Плюсы**: Гарантия, что данные сохранены на нескольких серверах.
- **Минусы**: Замедляет операции записи, особенно при плохой сети.
#### Асинхронная репликация

- **Где**: Соцсети, блоги, аналитика — системы с высокой нагрузкой на запись и допустимой задержкой чтения.
- **Пример**: Twitter — твит публикуется на мастере, а реплики обновляют ленту с задержкой.
- **Плюсы**: Быстрая запись, масштабируемость.
- **Минусы**: Возможна временная несогласованность (например, пользователь не сразу видит свой твит).

---
### Итог
  
- **Синхронная**: Медленнее, но надежнее — мастер ждет реплик, полная согласованность.
- **Асинхронная**: Быстрее, но менее надежно — реплики отстают, eventual consistency.

Выбор зависит от приоритетов: скорость записи (асинхронная) или надежность и согласованность (синхронная)


-----
**Zero-Links**  (Внутренние ссылки) Линки - ключевые слова
-

------
**Links** (Внешние ссылки)
-
