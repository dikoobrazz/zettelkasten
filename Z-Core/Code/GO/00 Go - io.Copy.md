2025012922:24
___
Date: 29-01-2025 | 22:24
Tags: #go #io #copy
mapofcontents:
___
## io.Copy

>`io.Copy(dst, src)` — это удобный способ скопировать данные из `io.Reader` в `io.Writer`, не загружая их в память полностью.

**Что такое `io.Reader` и `io.Writer`?**
- **[[00 Go - io.Reader|io.Reader]]** — это интерфейс, который предоставляет метод `Read(p []byte) (n int, err error)`. Он позволяет читать данные из источника (файла, сети, буфера и т. д.).
- **[[00 Go - io.Writer|io.Writer]]** — это интерфейс с методом `Write(p []byte) (n int, err error)`. Он позволяет записывать данные в файл, сокет, буфер и т. д.

Так как файлы реализуют эти интерфейсы (`os.File` удовлетворяет `io.Reader` и `io.Writer`), мы можем передавать их в `io.Copy` без дополнительных преобразований.

**Пример копирования данных из одного файла в другой**
```go
srcFile, err := os.Open("source.txt")
if err != nil {
	log.Fatal(err)
}
defer srcFile.Close()

dstFile, err := os.Create("destination.txt")
if err != nil {
	log.Fatal(err)
}
defer dstFile.Close()

_, err = io.Copy(dstFile, srcFile)
if err != nil {
	log.Fatal(err)
}
```

**Преимущество:** `io.Copy` копирует данные блоками, не перегружая память.

**Как работает `io.Copy`?**
Вызов `io.Copy(dst, src)` внутри себя выполняет:
1. Чтение данных из `src` (реализующего `io.Reader`) блоками.
2. Запись этих данных в `dst` (реализующий `io.Writer`).
3. Повторение процесса, пока `src` не вернет `EOF`.

Это делает код простым и эффективным, особенно когда работаем с файлами, потоками или сетевыми соединениями.

**Пример альтернативного подхода**
Если бы мы сами реализовали копирование без `io.Copy`, код выглядел бы так:
```go
buf := make([]byte, 4096) // Буфер на 4KB
for {
	n, err := src.Read(buf)
	if err != nil && err != io.EOF {
		log.Fatal(err)
	}
	if n == 0 {
		break
	}
	_, err = dst.Write(buf[:n])
	if err != nil {
		log.Fatal(err)
	}
}
```

Как видно, `io.Copy` выполняет ту же работу, но внутри библиотеки Go, что делает код чище и безопаснее.

**Когда использовать `io.Copy`, а когда писать свой код?**
- **Использовать `io.Copy`**, если просто нужно передать данные из одного потока в другой.
- **Реализовывать вручную**, если нужно:
    - Добавлять логику (например, изменять данные при копировании).
    - Работать с нестандартными источниками данных.
    - Контролировать размер буфера или обработку ошибок.

`io.Copy` — это удобный хелпер

-----
**Zero-Links**  (Внутренние ссылки) Линки - ключевые слова
- [[ml Go IO]]
- [[00 Go - io.Reader]]
- [[00 Go - io.Writer]]
------
**Links** (Внешние ссылки)
-
